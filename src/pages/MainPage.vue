<template>
  <div class="VBot-container px-5 py-5">   
    <div class="flex flex-row justify-center gap-12 mt-[30vh]">
        <div class="flex flex-col items-center gap-4">
            <span>
        <svg
          width="100"
          height="100"
          viewBox="0 0 256 256"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <rect
            width="256"
            height="256"
            rx="40"
            fill="url(#paint0_linear_6514_8)"
          />
          <path
            d="M128.001 43.52C75.6887 43.52 33.2803 78.6271 33.2803 121.96C33.2803 150.055 51.1142 174.691 77.9349 188.548C77.9349 188.548 79.3265 199.064 64.6567 211.812C64.6567 211.812 74.6154 215.022 98.583 199.079L122.45 200.279C124.285 200.346 126.135 200.383 128.001 200.389C180.321 200.389 222.72 165.3 222.72 121.975C222.72 78.65 180.289 43.52 128.001 43.52ZM83.5017 96.6401C83.5037 95.2745 83.775 93.9214 84.3008 92.6605C84.8266 91.3996 85.5965 90.2548 86.566 89.2906C87.5355 88.3264 88.6854 87.5621 89.951 87.0414C91.2167 86.5207 92.5725 86.2556 93.9415 86.2576C95.3112 86.2546 96.6684 86.5174 97.9349 87.0376C99.2014 87.5579 100.352 88.3225 101.323 89.2868C102.293 90.2511 103.064 91.3991 103.59 92.6605C104.116 93.9219 104.389 95.2738 104.391 96.6401C104.389 99.4029 103.287 102.052 101.328 104.005C99.3683 105.958 96.7113 107.053 93.9415 107.053C91.1731 107.051 88.5188 105.954 86.5613 104.001C84.6037 102.048 83.5038 99.4015 83.5017 96.6401ZM153.834 149.45C150.306 152.601 146.14 154.958 141.618 156.36C137.096 157.762 132.324 158.176 127.627 157.575C122.919 158.002 118.175 157.414 113.716 155.849C109.257 154.283 105.188 151.777 101.786 148.503C100.447 146.911 99.438 145.072 98.8174 143.088C98.1969 141.105 97.9775 139.015 98.1712 136.947L98.2101 134.717C98.2956 130.614 101.661 130.328 105.766 130.994L108.247 131.426C112.359 132.101 115.678 133.507 115.593 137.632L115.546 140.12C115.492 141.903 112.872 147.402 127.829 147.681C142.786 147.961 140.4 142.385 140.432 140.57L140.486 138.121C140.571 133.987 143.953 132.692 148.089 132.172L150.576 131.862C154.712 131.311 158.048 131.72 157.962 135.83V138.071C158.064 140.148 157.754 142.225 157.051 144.183C156.348 146.14 155.265 147.94 153.864 149.48L153.834 149.45ZM162.059 107.053C160.688 107.054 159.33 106.788 158.064 106.265C156.797 105.743 155.646 104.975 154.677 104.008C153.707 103.042 152.938 101.894 152.413 100.631C151.889 99.3679 151.618 98.0149 151.618 96.6476C151.619 95.2817 151.89 93.9294 152.415 92.6681C152.941 91.4067 153.711 90.2625 154.681 89.2981C155.65 88.3338 156.801 87.5694 158.067 87.049C159.333 86.5286 160.69 86.2621 162.059 86.2652C163.428 86.2632 164.784 86.5283 166.049 87.049C167.315 87.5697 168.465 88.334 169.435 89.2981C170.404 90.2623 171.174 91.4072 171.7 92.6681C172.226 93.929 172.498 95.282 172.5 96.6476C172.499 98.0143 172.228 99.3688 171.703 100.631C171.177 101.893 170.408 103.039 169.438 104.005C168.469 104.97 167.318 105.736 166.051 106.258C164.785 106.78 163.429 107.046 162.059 107.045V107.053Z"
            fill="white"
          />
          <defs>
            <linearGradient
              id="paint0_linear_6514_8"
              x1="128"
              y1="0"
              x2="128"
              y2="247.04"
              gradientUnits="userSpaceOnUse"
            >
              <stop stop-color="#20C55A" />
              <stop offset="1" stop-color="#119941" />
              <stop offset="1" stop-color="#1CAB4E" />
            </linearGradient>
          </defs>
        </svg>
      </span>
      <span class="logo-label text-VBotcolor-50 text-xl">VBot</span>
        </div>

        <div class="py-5">
            <span>
                <svg t="1737011026815" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18980" id="mx_n_1737011026815" width="50" height="50"><path d="M576 64H448v384H64v128h384v384h128V576h384V448H576z" fill="#03c75b" p-id="18981"></path></svg>
            </span>
        </div>

      <div class="flex flex-col items-center gap-4">
        <span>
        <svg
          t="1736997288860"
          class="icon"
          viewBox="0 0 1186 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="4406"
          data-darkreader-inline-fill=""
          width="100"
          height="100"
        >
          <path
            d="M948.937557 0H1186.171946L593.085973 1023.073303 0 0h453.710769L593.085973 237.234389 729.495747 0h219.44181z"
            fill="#41B883"
            p-id="4407"
            data-darkreader-inline-fill=""
            style="--darkreader-inline-fill: #349369"
          ></path>
          <path
            d="M0 0l593.085973 1023.073303L1186.171946 0h-237.234389L593.085973 613.843982 234.268959 0H0z"
            fill="#41B883"
            p-id="4408"
            data-darkreader-inline-fill=""
            style="--darkreader-inline-fill: #349369"
          ></path>
          <path
            d="M234.268959 0L593.085973 616.809412 948.937557 0h-219.44181L593.085973 237.234389 453.710769 0H234.268959z"
            fill="#35495E"
            p-id="4409"
            data-darkreader-inline-fill=""
            style="--darkreader-inline-fill: #2a3a4b"
          ></path>
        </svg>
      </span>
      <span class="logo-label text-VBotcolor-50 text-xl">VueJS</span>
      </div>
      
    </div>
    <span class="flex justify-center text-xl mt-4">An example of VBot Web Plugin use in VueJS</span>
    <VBotCallButtons />  
   
  </div>
</template>

<script>
import { ref, onMounted, onBeforeUnmount, getCurrentInstance } from 'vue'
import VBotCallButtons from '../components/VBotCallButtons.vue'


export default {
  name: 'MainPage',
  props: [
    
  ],
  components: {
   
    VBotCallButtons,
    
  },
  setup() {
    const client = ref(null)
    const { proxy } = getCurrentInstance()

    const handleStatusUpdate = (status) => {
      console.log(`Trạng thái tài khoản đã thay đổi thành ${status}`);
    }

    const handleNumberFromDialpad = (phoneNumber, hotline) => {
      console.log(`Gọi từ bàn phím: Hotline ${hotline} Số điện thoại ${phoneNumber}`);
      makeCall(phoneNumber, hotline);
    }

    const makeCall = (phoneNumber, hotline) => {
      console.log(`Gọi đi: Hotline ${hotline} Số điện thoại ${phoneNumber}`);
      
    }

    const setupEventListeners = () => {
      if (client.value) {
        client.value.on("statusUpdate", handleStatusUpdate);
        client.value.on("numberFromDialpad", handleNumberFromDialpad);
      }
    }

    const removeEventListeners = () => {
      // if (client.value) {
      //   client.value.removeEventListeners("statusUpdate", handleStatusUpdate);
      //   client.value.removeEventListeners("numberFromDialpad", handleNumberFromDialpad);
      // }
    }

    onMounted(async () => {
      try {
        const tokenUser = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJWYWx1ZSI6IjM2Mi0zNTY1LTEyMS0zMTIifQ.MhXkmrzQbUXEmzbsq5fzCwd3LBEXjSK9Bd9JPRYErYM';
        
        if (proxy.$initVBotClient) {
          await proxy.$initVBotClient(tokenUser);
          console.log(`initVBotClient`);
          client.value = proxy.$getVBotClient();
          
          if (client.value) {
            setupEventListeners();
            
            // Gọi connect() sau khi đã khởi tạo và thiết lập event listeners
            try {
              await client.value.connect();
              console.log('VBotClient đã kết nối thành công');
            } catch (connectError) {
              console.error('Lỗi khi kết nối VBotClient:', connectError);
            }
          } else {
            console.error('Không thể lấy VBotClient');
          }
        } else {
          console.error('$initVBotClient không tồn tại');
        }
      } catch (error) {
        console.error('Lỗi khi khởi tạo VBotClient:', error);
      }
    })

    onBeforeUnmount(() => {
      removeEventListeners();
    })
  }  
}

</script>
